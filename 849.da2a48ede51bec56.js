"use strict";(self.webpackChunkSouthDhakaCyclists=self.webpackChunkSouthDhakaCyclists||[]).push([[849],{908:(M,C,c)=>{c.r(C),c.d(C,{MessgesModule:()=>F});var T=c(4466),f=c(6895),h=c(4976),d=c(2347),U=c(1446),e=c(8256),x=c(529);let Z=(()=>{const o=class{constructor(t){this.http=t,this.url=d.N.apiUrl+"/messege"}getMesseges(t,s=0,r=100){return this.http.get(this.url+`/chat/${t}?page=${s}&size=${r}`)}getChats(t=0,s=20){return this.http.get(this.url+`?page=${t}&size=${s}`)}sendMessage(t){return this.http.post(this.url,t)}getSuggestions(t,s=0,r=20){return this.http.get(this.url+`/newChatSuggestions/${t}?page=${s}&size=${r}`)}createChat(t,s){return this.http.get(this.url+`/newChat?name=${t}&ids=${s}`)}};let i=o;return o.\u0275fac=function(s){return new(s||o)(e.LFG(x.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),i})();var m=c(8320),l=c(433),u=c(2541);function p(i,o){if(1&i&&(e.TgZ(0,"span",32),e._uU(1),e.qZA()),2&i){const n=e.oxw().$implicit,t=e.oxw(2);e.xp6(1),e.Oqu(t.hasNew(n))}}function _(i,o){if(1&i){const n=e.EpF();e.TgZ(0,"div",26),e.NdJ("click",function(){const r=e.CHM(n).$implicit,a=e.oxw(2);return e.KtG(a.selectChat(r))}),e.TgZ(1,"div",27),e._UZ(2,"img",28),e.TgZ(3,"div")(4,"strong"),e._uU(5),e.qZA(),e.TgZ(6,"small",29),e._uU(7),e.qZA()(),e.TgZ(8,"div",30),e.YNc(9,p,2,1,"span",31),e.qZA()()()}if(2&i){const n=o.$implicit,t=e.oxw(2);e.xp6(2),e.s9C("src",t.getImageUrl(n),e.LSH),e.xp6(3),e.Oqu(n.name),e.xp6(2),e.Oqu(n.lastMessage),e.xp6(2),e.Q6J("ngIf",t.hasNew(n)>0)}}function v(i,o){if(1&i&&(e.TgZ(0,"div")(1,"h4"),e._uU(2,"Searched Chats"),e.qZA(),e.TgZ(3,"div",7),e.YNc(4,_,10,4,"div",8),e.qZA()()),2&i){const n=e.oxw();e.xp6(4),e.Q6J("ngForOf",n.filteredChats)}}function b(i,o){if(1&i&&(e.TgZ(0,"span",32),e._uU(1),e.qZA()),2&i){const n=e.oxw().$implicit,t=e.oxw();e.xp6(1),e.Oqu(t.hasNew(n))}}function w(i,o){if(1&i){const n=e.EpF();e.TgZ(0,"div",26),e.NdJ("click",function(){const r=e.CHM(n).$implicit,a=e.oxw();return e.KtG(a.selectChat(r))}),e.TgZ(1,"div",27),e._UZ(2,"img",28),e.TgZ(3,"div")(4,"strong"),e._uU(5),e.qZA(),e.TgZ(6,"small",29),e._uU(7),e.qZA()(),e.TgZ(8,"div",30),e.YNc(9,b,2,1,"span",31),e.qZA()()()}if(2&i){const n=o.$implicit,t=e.oxw();e.xp6(2),e.s9C("src",t.getImageUrl(n),e.LSH),e.xp6(3),e.Oqu(n.name),e.xp6(2),e.Oqu(n.lastMessage),e.xp6(2),e.Q6J("ngIf",t.hasNew(n)>0)}}function y(i,o){if(1&i&&(e.ynx(0,45),e.TgZ(1,"div",46)(2,"div",47),e._UZ(3,"img",48),e.TgZ(4,"span",49)(5,"span",50),e._uU(6),e.qZA()()(),e.TgZ(7,"span",51),e._uU(8),e.ALo(9,"timeAgo"),e.qZA()(),e.BQk()),2&i){const n=e.oxw().$implicit,t=e.oxw(2);e.xp6(3),e.s9C("src",t.getImageUrl(n.sender),e.LSH),e.xp6(3),e.hij(" ",n.message," "),e.xp6(2),e.Oqu(e.lcZ(9,3,n.createdAt))}}function A(i,o){if(1&i&&(e.TgZ(0,"div",46)(1,"span",52),e._uU(2),e.ALo(3,"timeAgo"),e.qZA(),e.TgZ(4,"div",53)(5,"span",49)(6,"span",50),e._uU(7),e.qZA()(),e._UZ(8,"img",54),e.qZA()()),2&i){const n=e.oxw().$implicit,t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,3,n.createdAt)),e.xp6(5),e.hij(" ",n.message," "),e.xp6(1),e.s9C("src",t.getImageUrl(n.sender),e.LSH)}}function q(i,o){if(1&i&&(e.TgZ(0,"div",41),e.YNc(1,y,10,5,"ng-container",42),e.YNc(2,A,9,5,"ng-template",43,44,e.W1O),e.qZA()),2&i){const n=o.$implicit,t=e.MAs(3),s=e.oxw(2);e.xp6(1),e.Q6J("ngIf",n.sender.id!==s.currentUserId)("ngIfElse",t)}}function I(i,o){if(1&i){const n=e.EpF();e.TgZ(0,"div",33)(1,"div",34)(2,"h5"),e._uU(3),e.qZA()(),e.TgZ(4,"div",35),e.YNc(5,q,4,2,"div",36),e.qZA(),e.TgZ(6,"div",37)(7,"div",38)(8,"input",39),e.NdJ("ngModelChange",function(s){e.CHM(n);const r=e.oxw();return e.KtG(r.messageText=s)})("keydown.enter",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.sendMessage())}),e.qZA(),e.TgZ(9,"button",40),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.sendMessage())}),e._uU(10,"Send"),e.qZA()()()()}if(2&i){const n=e.oxw();e.xp6(3),e.Oqu(n.selectedChat.name),e.xp6(2),e.Q6J("ngForOf",n.messeges),e.xp6(3),e.Q6J("ngModel",n.messageText)}}function N(i,o){1&i&&(e.TgZ(0,"div",55)(1,"h5"),e._uU(2,"Select a chat to start messaging"),e.qZA()())}function O(i,o){if(1&i){const n=e.EpF();e.TgZ(0,"li",56)(1,"div",57),e.NdJ("click",function(){const r=e.CHM(n).$implicit,a=e.oxw();return e.KtG(a.removeUser(r))}),e._UZ(2,"img",28),e.TgZ(3,"div")(4,"strong"),e._uU(5),e.qZA(),e.TgZ(6,"small",29),e._uU(7),e.qZA()(),e.TgZ(8,"button",58),e._uU(9,"Remove"),e.qZA()()()}if(2&i){const n=o.$implicit,t=e.oxw();e.xp6(2),e.s9C("src",t.getImageUrl(n),e.LSH),e.xp6(3),e.Oqu(n.fullName),e.xp6(2),e.Oqu(n.email)}}function J(i,o){if(1&i){const n=e.EpF();e.TgZ(0,"li",56)(1,"div",57),e.NdJ("click",function(){const r=e.CHM(n).$implicit,a=e.oxw();return e.KtG(a.selectUser(r))}),e._UZ(2,"img",28),e.TgZ(3,"div")(4,"strong"),e._uU(5),e.qZA(),e.TgZ(6,"small",29),e._uU(7),e.qZA()()()()}if(2&i){const n=o.$implicit,t=e.oxw();e.xp6(2),e.s9C("src",t.getImageUrl(n),e.LSH),e.xp6(3),e.Oqu(n.fullName),e.xp6(2),e.Oqu(n.email)}}const S=[{path:"",redirectTo:"messegeLists",pathMatch:"full"},{path:"messegeLists",component:(()=>{const o=class{constructor(t,s){this.messegeService=t,this.usersService=s,this.user=null,this.apiUrl=d.N.apiUrl,this.currentUserId=this.user?.id,this.messeges=[],this.interval=null,this.searchText="",this.messageText="",this.selectedChat=null,this.chats=[],this.filteredChats=[],this.oldChats=[],this.chatName="",this.searchTerm="",this.suggestedUsers=[],this.selectedUsers=[]}ngOnDestroy(){clearInterval(this.interval)}ngOnInit(){this.usersService.user.subscribe(t=>{this.user=t}),this.messegeService.getChats().subscribe(t=>{this.chats=t.content,this.oldChats=this.chats,this.startInterval()})}startInterval(){this.interval=setInterval(()=>{this.refreshChats()},2e3)}refreshChats(){this.messegeService.getChats().subscribe(t=>{this.chats=t.content}),this.selectedChat&&this.selectChat(this.selectedChat)}hasNew(t){let s=t.id,r=this.oldChats.find(g=>g.id===s).messegeCount;return t.messegeCount-r}selectChat(t){this.selectedChat=t,this.messegeService.getMesseges(t.id).subscribe(r=>{this.messeges=r.content,setTimeout(()=>{this.scrollToBottom()},100)});let s=this.oldChats.find(r=>r.id===t.id);s&&this.oldChats.splice(this.oldChats.indexOf(s),1),this.oldChats.push(t)}scrollToBottom(){const t=document.querySelector(".chat-body");t&&(t.scrollTop=t.scrollHeight)}sendMessage(){""!==this.messageText.trim()&&this.messegeService.sendMessage({messege:this.messageText,chatId:this.selectedChat.id}).subscribe(t=>{this.messeges.push(t),this.messageText="",setTimeout(()=>{this.scrollToBottom()},100)})}filterChats(){this.filteredChats=""!==this.searchText?this.chats.filter(t=>t.name.toLowerCase().includes(this.searchText.toLowerCase())):[]}getImageUrl(t){return t.groupImage?this.apiUrl+t.groupImage?.url:"assets/logo/pigeon.webp"}searchUsers(){this.messegeService.getSuggestions(this.searchTerm).subscribe(t=>{let s=t.content;s=s.filter(r=>r.id!==this.currentUserId),this.suggestedUsers=s.filter(r=>!this.selectedUsers.find(a=>a.id===r.id))})}selectUser(t){this.selectedUsers.find(s=>s.id===t.id)||(this.selectedUsers.push(t),this.suggestedUsers=this.suggestedUsers.filter(s=>s.id!==t.id))}removeUser(t){this.selectedUsers=this.selectedUsers.filter(s=>s.id!==t.id),this.suggestedUsers.push(t)}createChat(){this.messegeService.createChat(this.chatName,this.selectedUsers.map(t=>t.id)).subscribe(t=>{this.chats.push(t),this.filteredChats.push(t),this.selectedUsers=[],this.chatName="",this.searchTerm="",this.suggestedUsers=[],this.selectedChat=t;const s=document.getElementById("modalId");if(s){(U.u_.getInstance(s)||new U.u_(s)).hide();const a=document.querySelector(".modal-backdrop");a&&a.remove(),document.body.classList.remove("modal-open")}})}};let i=o;return o.\u0275fac=function(s){return new(s||o)(e.Y36(Z),e.Y36(m.f))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-messges"]],decls:36,vars:9,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-4","p-3","border","shadow",2,"height","100vh"],[1,"mb-3"],["type","text","placeholder","Search chats...",1,"form-control",3,"ngModel","ngModelChange","input"],[4,"ngIf"],["data-bs-toggle","modal","data-bs-target","#modalId",1,"btn","btn-outline-info"],[1,"list-group"],["class","list-group-item list-group-item-action",3,"click",4,"ngFor","ngForOf"],[1,"col-md-8","p-3"],["class","border rounded-3","style","height: 90vh;",4,"ngIf"],["class","text-center","style","height: 100%;",4,"ngIf"],["id","modalId","tabindex","-1","role","dialog","aria-labelledby","modalTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-scrollable","modal-dialog-centered","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","modalTitleId",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"input-group","my-3"],["type","text","placeholder","Enter chat name",1,"form-control",3,"ngModel","ngModelChange"],["class","list-group-item",4,"ngFor","ngForOf"],["type","text","placeholder","Search for a user",1,"form-control",3,"ngModel","ngModelChange","input"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary",3,"click"],[1,"list-group-item","list-group-item-action",3,"click"],[1,"d-flex","justify-content-between","align-items-center"],["alt","",1,"rounded-circle","me-2",2,"width","40px","height","40px",3,"src"],[1,"d-block","text-muted"],[1,"ms-auto"],["class","badge bg-info h-100 rounded rounded-circle",4,"ngIf"],[1,"badge","bg-info","h-100","rounded","rounded-circle"],[1,"border","rounded-3",2,"height","90vh"],[1,"chat-header","p-3"],[1,"chat-body","p-3",2,"height","75%","overflow-y","auto"],["class","message",4,"ngFor","ngForOf"],[1,"chat-footer","p-3"],[1,"input-group"],["type","text","placeholder","Type a message...",1,"form-control",3,"ngModel","ngModelChange","keydown.enter"],[1,"btn","btn-primary",3,"click"],[1,"message"],["class","w-100",4,"ngIf","ngIfElse"],["class","w-100"],["elseBlock",""],[1,"w-100"],[1,"d-flex","align-items-center","mb-2"],[1,"d-flex","bg-success","rounded-pill",2,"width","fit-content"],["alt","",1,"rounded-circle",2,"width","40px","height","40px",3,"src"],[1,"py-2"],[1,"message-text"],[1,"text-muted","small","ms-2"],[1,"text-muted","small","ms-auto"],[1,"d-flex","bg-primary","rounded-pill","ms-2",2,"width","fit-content"],["alt","",1,"rounded-circle","ms-2",2,"width","40px","height","40px",3,"src"],[1,"text-center",2,"height","100%"],[1,"list-group-item"],[1,"d-flex","align-items-center",3,"click"],["type","button",1,"btn","btn-outline-danger","btn-sm","ms-auto"]],template:function(s,r){1&s&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"input",4),e.NdJ("ngModelChange",function(g){return r.searchText=g})("input",function(){return r.filterChats()}),e.qZA()(),e.YNc(5,v,5,1,"div",5),e.TgZ(6,"h4"),e._uU(7,"Inbox "),e.TgZ(8,"button",6),e._uU(9,"New"),e.qZA()(),e.TgZ(10,"div",7),e.YNc(11,w,10,4,"div",8),e.qZA()(),e.TgZ(12,"div",9),e.YNc(13,I,11,3,"div",10),e.YNc(14,N,3,0,"div",11),e.qZA()()(),e.TgZ(15,"div",12)(16,"div",13)(17,"div",14)(18,"div",15)(19,"h5",16),e._uU(20," New Chat "),e.qZA(),e._UZ(21,"button",17),e.qZA(),e.TgZ(22,"div",18)(23,"div",19)(24,"input",20),e.NdJ("ngModelChange",function(g){return r.chatName=g}),e.qZA()(),e.TgZ(25,"ul",7),e.YNc(26,O,10,3,"li",21),e.qZA(),e.TgZ(27,"div",19)(28,"input",22),e.NdJ("ngModelChange",function(g){return r.searchTerm=g})("input",function(){return r.searchUsers()}),e.qZA()(),e.TgZ(29,"ul",7),e.YNc(30,J,8,3,"li",21),e.qZA()(),e.TgZ(31,"div",23)(32,"button",24),e._uU(33," Close "),e.qZA(),e.TgZ(34,"button",25),e.NdJ("click",function(){return r.createChat()}),e._uU(35,"Save"),e.qZA()()()()()),2&s&&(e.xp6(4),e.Q6J("ngModel",r.searchText),e.xp6(1),e.Q6J("ngIf",r.filteredChats.length>0),e.xp6(6),e.Q6J("ngForOf",r.chats),e.xp6(2),e.Q6J("ngIf",r.selectedChat),e.xp6(1),e.Q6J("ngIf",!r.selectedChat),e.xp6(10),e.Q6J("ngModel",r.chatName),e.xp6(2),e.Q6J("ngForOf",r.selectedUsers),e.xp6(2),e.Q6J("ngModel",r.searchTerm),e.xp6(2),e.Q6J("ngForOf",r.suggestedUsers))},dependencies:[f.sg,f.O5,l.Fj,l.JJ,l.On,u.e],styles:[".chat-body[_ngcontent-%COMP%]{max-height:75vh;overflow-y:scroll}.message-text[_ngcontent-%COMP%]{border-radius:12px;padding:10px;margin:5px;max-width:75%;word-wrap:break-word}input.form-control[_ngcontent-%COMP%]{border-radius:30px}"]}),i})()}];let $=(()=>{const o=class{};let i=o;return o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[h.Bz.forChild(S),h.Bz]}),i})(),F=(()=>{const o=class{};let i=o;return o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[f.ez,$,l.u5,l.UX,T.m]}),i})()},2541:(M,C,c)=>{c.d(C,{e:()=>f});var T=c(8256);let f=(()=>{const d=class{transform(e){if(!e)return"";const x=new Date,Z=new Date(e),m=Math.floor((x.getTime()-Z.getTime())/1e3),l=Math.floor(m/60),u=Math.floor(l/60),p=Math.floor(u/24),_=Math.floor(p/30),v=Math.floor(_/12);return m<60?1===m?"1 second ago":`${m} seconds ago`:l<60?1===l?"1 minute ago":`${l} minutes ago`:u<24?1===u?"1 hour ago":`${u} hours ago`:p<30?1===p?"1 day ago":`${p} days ago`:_<12?1===_?"1 month ago":`${_} months ago`:1===v?"1 year ago":`${v} years ago`}};let h=d;return d.\u0275fac=function(x){return new(x||d)},d.\u0275pipe=T.Yjl({name:"timeAgo",type:d,pure:!0}),h})()}}]);